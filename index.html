<!doctype html>
<html lang="en" class="mainPage">
<head>
<style>
#body {
	background-color: rgb(0, 102, 153);
 }

    #fbButton{
         background-image: url(fbimg.png);
         background-size: 100% 100%;
         background-repeat: no-repeat;
         width: 40px;
         height: 35px;
    }
    .detailHeader{
        text-align: center;
        font-weight: bold;
        
    } 
#formFistSection {
	background-color: white;
	border-radius: 5px;
	padding-left: 20px;
	padding-right: 20px;
	padding-bottom: 30px;
}
    .secContainer{
    background-color: white;
	border-radius: 5px;
	padding-left: 10px;
	padding-right: 10px;
	padding-bottom: 30px;
    padding-top:10px;
        
    }
.StockDetails{
         text-align: center;
    }
    
.formH1 {
                text-align: center;
                font-style: Arial;
                font-size: 25px;
                padding-top: 25px;
}
#logoImage{
        height: 25px;
        width: 125px;
    }
    
   #validationInformation {
    color: red;
}
</style>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
    
<!-- <meta name="viewport" content="width=device-width, initial-scale=1">-->
<title>hw8 Exercise</title>
<!-- import resources -->
<script src="moment.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">   
<script   src="https://code.jquery.com/jquery-1.12.2.min.js"   integrity="sha256-lZFHibXzMHo3GGeehn1hudTAP3Sc0uKXBXAzHX1sjtk="   crossorigin="anonymous"></script>
    
 <script   src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"   integrity="sha256-xNjb53/rY+WmG+4L6tTl9m6PpqknWZvRt0rO1SRnJzw="   crossorigin="anonymous"></script>
    
     <script   src="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css"   integrity="sha256-xNjb53/rY+WmG+4L6tTl9m6PpqknWZvRt0rO1SRnJzw="   crossorigin="anonymous"></script>
    

<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<!-- Latest compiled JavaScript -->
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
  <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
   
    

</head>
<body id="body">
    
<!--set up the facebook SDK -->

<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1579905572322363',// application ID 
      xfbml      : true,
      version    : 'v2.5'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>

    
<!-- the whole div-->   
<div class="container">
    <!-- the form div-->   
    <div id="formFistSection">
       <form id="searchForm" class="form-horizontal" role="form" name="myform" action= "" method="GET" name="myform" >
            <h1 class="formH1">Stock Market Search</h1>
         <div class = "row">
            
            <div class="col-sm-3">
            <label class="control-label" for="stockInput">Enter the stock name or symbol:<span style="color:red">*</span></label>
            </div>
            <br class = "visible-xs">
            <div class="col-sm-4">
             <input type="text" class="form-control"  name="inputText" placeholder="Apple Inc or AAPL" id="stockInput" required><br class = "visible-xs">
            </div>
            
            <div class="col-sm-5">
                <button type="submit"  class="btn btn-primary" id= "quoteButton"><span class="glyphicon glyphicon-search"></span>Get Quote </button>
                <button type="button" class="btn btn-default" onclick ="clearResult()"><span class=" glyphicon glyphicon-refresh"></span>Clear</button> <br>
            </div>
            
         <br class = "visible-xs">   
        </div>
         <!-- second row include validatinformation plus Markit on Demand logo-->  
        <div class = "row">
            <!-- this will be set for output validation information, first is null-->
            <div class="col-sm-4 col-sm-offset-3" id="validationInformation"></div>
            <div class="col-sm-5">
                <label for="logo">Powered by:</label><a id="logoLink" target="_blank" href="http://dev.markitondemand.com/MODApis/"><img id="logoImage" alt="Markit on Demand logo" src="mod-logo.png" ></a>
            </div>
        </div><!--for row-->  
     </form>
    </div> <!--upper part-->
    <hr id="lineHR">
    <!-- below is the second part of first figure, result show in carousel still need to figure out how to solve this part--> 
    <div class="secContainer">
    <div id="myCarousel" class="carousel slide" data-ride="carousel" data-interval="false">
        <!--thecarousel need id , class, data ride -->
        
        
        <!-- Wrapper for slide>-->
        <div class="carousel-inner">
            <!-- favorite section-->
            <div class="item active">
                <div class="panel panel-default">
                    <div class="panel-heading">
                          <label>Favorite List:</label>
                           <div class="pull-right"><span class = "hidden-xs">
                               Automatic Refresh:</span><span data-toggle="tooltip" data-placement="bottom" title="Auto Refresh "><input id="autoRefreshButton" type="checkbox" data-toggle="toggle"></span>
                            <button type="submit" id="refreshButton" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" title="Refresh button" ><span class="glyphicon glyphicon-refresh"></span></button>
                            <!--below need to modify-->
                               <button type="submit" id="nextSlide" class="btn btn-default" href="#myCarousel" data-slide="next" data-toggle="tooltip" data-placement="bottom" title="show Stock information" disabled ="true"><span class="glyphicon glyphicon-chevron-right"></span></button>
                          </div>
                    </div>
                    <div class="panel-body">
                                    <div  class="table-responsive">
                                     <table id="favoriteTable" class="table table-striped table-responsive">
                                        <tr>
                                            <th>Symbol</th>
                                            <th>Company Name</th>
                                            <th>Stock Price</th>
                                            <th>Change (Change Percent)</th>
                                            <th>Market Cap</th>
                                            <th>      </th>
                                        </tr>
                                    </table>
                        </div> 
                    </div>
                </div>
            </div><!--end of favorite section-->
            <!-- below is the stock detail item-->
                <div class ="item"><!--second slide section-->
                    <div class="panel panel-default" id="sectionTwo">
                        <div class="panel-heading">
                     
                    <!-- stock detail panel heading include left button and stock detail text-->
                      
                          <button type="submit" class="btn btn-default" href="#myCarousel" data-slide="prev" onclick()="refreshFavoritePannel()"><span class="glyphicon glyphicon-chevron-left"></span></button> <strong>Stock Details</strong>
                        </div>
                             
                   
                        </div>
                        
                        <div class="panel-body">
                            <!--below is the navigation section--oh my god, so complicated555>-->
                            <div id= tags>
                            <ul class="nav nav-pills">
                                <li class="active"><a data-toggle="pill" href="#currentStock"><span class="glyphicon glyphicon-dashboard"></span><span class = "visible-xs">Stock</span><span class = "hidden-xs">Current Stock</span></a></li>
                                 <li><a data-toggle="pill" href="#HistoricalCharts"><span class="glyphicon glyphicon-stats"></span><span class = "visible-xs">Charats</span><span class = "hidden-xs">Historical Charts</span></a></li>
                                <li><a data-toggle="pill" href="#newsFeeds"><span class="glyphicon glyphicon-link"></span><span class = "visible-xs">News</span><span class = "hidden-xs">News Feeds</span></a></li>
                             </ul>
                             <hr>
                            </div>
                            
                            <div id="tagDetail">
                                <div class="tab-content">
                                    <div id="currentStock" class="tab-pane fade in active">
                                     <!-- below is the desdign for current stock information-->
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <span><strong>Stock Details</strong></span>
                                            <div class="pull-right">
                                                <button id="fbButton" type="button" class="btn btn-primary" onclick="ShowFacebook()">
                                                </button>
                                                <button  id="favouriteButton" type="button" class="btn btn-default" >
                                                <span id="favouriteStar" class="glyphicon glyphicon-star-empty"></span>
                                                </button>
                                            </div>
                                           
                                            </div>
                                        </div>
                                        <div class="row">
                                          <div id="stockDetailSection" class="col-sm-6">
                                           <!--stock detail table-->
                                                
        
                                            </div>
                                            <!--stock chart-->
                                                 <div  id="stockChart" class="col-sm-6">
                                                    <!--will append image by jquery-->
                                                </div>
                                        </div>

                                     </div>
                              
                                      <div id="HistoricalCharts" class="tab-pane fade">
                                         <!--will append HistoricalCharts by jquery-->
                                         
                                      </div>
                                    
                                  
                                    <div id="newsFeeds" class="tab-pane fade">
                                         <!--will append newsFeeds by jquery-->
                                        
                                         
                                    </div>
                                </div>
                            
                            </div>
                        </div>

                    
                    </div>
                </div>
        
        
        </div><!-- end of carousel-inner - all- slide section-->
        
    </div> 
  </div><!--secContainer-->
</div> <!--the whole include the upper part and the second part-->
  
        
        
        
<!---All the script will be write down in below-->

<script>
    //facebook button take action
    function ShowFacebook(){
        // need some global variable to store some object at least the symbol we are now 
    //var curr_stock_json;
   // var curr_json_imgURL;
        var json = curr_stock_json;
        var stockImg = "http://chart.finance.yahoo.com/t?s="+json["Symbol"]+"&lang=en-US&width=300&height=300";
        var title = "Current Stock Price of "+ json["Name"]+ " is $" + json["LastPrice"];
        var subhead = "Stock Information of "+json["Name"]+ " ("+json["Symbol"]+")";
        var footText ="LAST PRICE: $"+json["LastPrice"]+", CHANGE: "+json["Change"].toFixed(2)+" ("+json["ChangePercent"].toFixed(2)+"%)";
        // post 
        // may need to check login API first
        FB.ui(  
                    {
                        method: "feed",
                        link: "http://dev.markitondemand.com/",
                        picture: stockImg,
                        name: title,
                        description: subhead,
                        caption: footText
                    },
                    //callback to check whether post sucessfully 
                    function(response){
                        if (response && !response.error_message) {
                          alert('Posted sucessfully');
                        } else {
                          alert('No Posted');
                        }
                    }
                );
    
    }
    
</script>
<script>
    // generate favorite row , duplicated code; 
    function generateFavoriteRow(jsonObject){
                      if(jsonObject["Status"] == "SUCCESS"){
                          //create each row in favorite list
                          // need to create each id for each row;
                          favorRow = "<tr id=\""+ jsonObject.Symbol +"\">";
                          favorRow += "<td>" +"<a href=\"#\" onclick=\"generateFormSectionTwo("+"\'"+jsonObject.Symbol+"\'" +")\">" + jsonObject.Symbol+ "</a></td>";
                          //favorRow += "<td>" +"<a href=\"#sectionTwo\"  onclick=\"generateFormSectionTwo("+ jsonObject.Symbol+")\">"+ jsonObject.Symbol + "</a></td>";
                          favorRow += "<td>" + jsonObject.Name + "</td>";
                          favorRow += "<td>" +"$ " + jsonObject.LastPrice + "</td>";
                          
                          var change = jsonObject.Change.toFixed(2);
                          var changePercent = jsonObject.ChangePercent.toFixed(2);
                          favorRow += "<td id=\"favorSymbol" +jsonObject.Symbol +"\">"+change+" ( "+changePercent +"%"+" ) "+showArrow(changePercent)+"</td>";
                          
                          // change 
                          var para = "favorSymbol"+jsonObject.Symbol;
                          console.log("this is para" + para);
                          changeTextColor(changePercent, para);
                          refreshFavoritePannel();
                          
                          favorRow += "<td>" + (jsonObject.MarketCap/1000000000).toFixed(2) + " Billion</td>"
                         var trashButton = "<button type=\"button\" class=\"btn btn-default\" onclick=\"deleteFavouriteRow(this, \'"+jsonObject .Symbol + "\');\"><span class=\"glyphicon glyphicon-trash\"></span></button>";
                          favorRow += "<td>"+trashButton+"</td>"; 
                          favorRow += "</tr>";
                          $("#favoriteTable").append(favorRow);

                       }
    }
</script>
<!--before handle the favorite part need to set up local store object-->
<!-- below is the local store object need　to load the the favordate data store in brower-->
<script>
 $( document ).ready(function(){
      
     if((localStorage.length) != 0){
         for(var i= 0; i < localStorage.length; i++){
             // need to get symbol back
             // will return the key name localStorage.key(i), use the symbol as the key name ，value should be “TRUE”
             var symbol =  localStorage.key(i);
             // need to call the ajax to render the favorite list
             $.ajax({
                  url: "index.php",
                  data: {symbolVal: symbol },
                 //async: false,
                  type: "GET",
                  datatype: "json",
                  success: function(result) {
                  var jsonObject = jQuery.parseJSON(result);
                     generateFavoriteRow(jsonObject);
    
                }
             });
             
         }
     }
     
    
 });
    
    
</script>
    
<script>
$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();   
});
</script>
    
<!--below section is to handle the favorite problem-->
<script>
    // the the add favor button was click then trigger 
     $("#favouriteButton").click(function(e) {
         e.preventDefault();
        if (curr_stock_json == null) {
        //console.log("current stock is null.");
        return;
        }
        // get the current objcet Symbol
        var stockSymbol = curr_stock_json.Symbol; 
       // console.log("stock symbol:" + stockSymbol); 
         // check if the stockSymbol was in localStorage 
         if(localStorage.length == 0 || localStorage.getItem(stockSymbol) === null){
             // the current symbol not in favorite list, we need add it;
             localStorage.setItem(stockSymbol,"TRUE");
             // update Start color
             updateStarSpan(stockSymbol);
             generateFavoriteRow(curr_stock_json);
         }else{
             //localStorage.removeItem(stockSymbol);
             //updateStarSpan(stockSymbol);
             deleteClick(stockSymbol);
         }

     });
    // change the star color
    function updateStarSpan(Symbol){
      //console.log("updateStarSpan");
     // console.log(favouriteList);
      //console.log(Symbol);
      if (localStorage.getItem(Symbol) == null) {
        //console.log("changeStar remove");
        $("#favouriteStar").removeClass("glyphicon glyphicon-star").addClass("glyphicon glyphicon-star-empty");
        $("#favouriteStar").css("color", "black");
      } else {
        //console.log("changeStar add");
        $("#favouriteStar").removeClass("glyphicon glyphicon-star-empty").addClass("glyphicon glyphicon-star");
        $("#favouriteStar").css("color", "yellow");
      }
    }
    
    function deleteClick(Symbol){
         //console.log("in storage && deleted");
         
         //console.log("in storage && deleted");
         $("#"+Symbol).remove();
         localStorage.removeItem(Symbol);
         updateStarSpan(Symbol);
    }
    
    function refreshFavoritePannel(){
        //$("#favoriteTable").empty();
        if((localStorage.length) != 0){
         for(var i= 0; i < localStorage.length; i++){
             // need to get symbol back
             // will return the key name localStorage.key(i), use the symbol as the key name ，value should be “TRUE”
             var symbol =  localStorage.key(i);
             // need to call the ajax to render the favorite list
             $.ajax({
                  url: "index.php",
                  data: {symbolVal: symbol },
                 //async: false,
                  type: "GET",
                  datatype: "json",
                  success: function(result) {
                  var jsonObject = jQuery.parseJSON(result);
                    // console.log("just update favor row");
                      
                     // generateFavoriteRow(jsonObject); generate the result is not right we need to update some will be enough
                                            //update row
                    $("#"+jsonObject.Symbol).find("td:eq(1)").html(jsonObject.Name);
                    $("#"+jsonObject.Symbol).find("td:eq(2)").html("$ " + jsonObject.LastPrice);
                                        
                        var change = jsonObject.Change.toFixed(2);
                        var changePercent = jsonObject.ChangePercent.toFixed(2);
                        $("#"+jsonObject.Symbol).find("td:eq(3)").html(change+" ( "+changePercent +"%"+" ) "+showArrow(changePercent));
                        var para = "favorSymbol"+jsonObject.Symbol;
                        changeTextColor(changePercent,para);
                                        
                                       // var marketCap = jsonObject["MarketCap"]/1000000000;
                                        //$("#"+jsonObject.Symbol).find("td:eq(4)").html(marketCap.toFixed(2)+" Billion");
                }
             });
             
         }
     }
        
    }
    //handle the refreshButton problem
     $("#refreshButton").click(function(e) {
      //$("#favoriteTable").empty();
     // console.log("refreshButton click.");
      refreshFavoritePannel();
    });
   
    
    // handle autoRefreshButton
    $("#autoRefreshButton").change(function() {
     console.log("autoRefreshButton");
      //console.log($("#autoRefreshButton").prop('checked'));
      if ($("#autoRefreshButton").prop('checked')) {
        //console.log("autorefesh favourite pannel on. set to 5s");
        autoRefreshFavouriteId = setInterval(function() {
            //console.log("autorefesh favourite pannel on. set to 5s");
            refreshFavoritePannel();
            }, 5000);
      } else {
        //console.log("autorefesh favourite pannel off.");
        clearInterval(autoRefreshFavouriteId);
      }
    });
    
    
    
    
    function deleteFavouriteRow(deleteButton, stockSymbol) {
      //console.log("deleteFavouriteRow");
      if (typeof(deleteButton) == "object") {
        $(deleteButton).closest("tr").remove();
        localStorage.removeItem(stockSymbol);
         updateStarSpan(stockSymbol);
      }
      //console.log(favouriteList);
    }

</script>
<!--quote section-->    
<script>
    //define two global object for call the facebook API
    // one global for recore currend jason object one for 
    // one for the picuture UIL
    var curr_stock_json;
    //var curr_json_imgURL;
    
    /*function clickToQuote(myform){
        var textVal = myform.inputText.value;//get the symbol.
        // first to check the input
        // require will test the input is empty or not. 
        // next need to check if the symbol has result
        alert(textVal);
        $.ajax({
            url: "hw8Quote.php",
            data: {symbolVal: textVal},
            type: "GET",
            datatype: "json",
            success: function( result ) {
                alert(result);*/
    $("#searchForm").submit(function(e) {
       
       e.preventDefault();
       var symbol = $("#stockInput").val();
       generateFormSectionTwo(symbol);
        }); 
    
    
     function generateFormSectionTwo(symbol){
        $("#stockDetailSection").empty();
        $("#stockChart").empty();
        //$(".well").remove();
        $("#newsFeeds").empty();
        //$("#newsFeeds").empty();
        $('#HistoricalCharts').empty();
        //$("#nextSlide").prop('disabled', True);
    // get the detail 
      $.ajax({
          url: "index.php",
          data: { symbolVal: symbol },
          //async: false,
          type: "GET",
          datatype: "json",
          success: function(result) {
          var jsonObject = jQuery.parseJSON(result);
          if(jsonObject["Message"]=="No symbol matches found for "+symbol+". Try another symbol such as MSFT or AAPL, or use the Lookup API."){
                document.getElementById("validationInformation").innerHTML = "Select a valid entry";
                $("#nextSlide").prop('disabled', true);
                console.log("this is not valid");
                return;
                
            }
              else{
              // $("#nextSlide").prop('disabled', false);
              // $("#myCarousel").carousel(1);
              // var jsonObject = jQuery.parseJSON(result);
               // update the star after load;
               updateStarSpan(jsonObject.Symbol);
               
               curr_stock_json= jsonObject;// for generate facebook feed;
                           /* if(jsonObject["Message"] == "No symbol matches found for AAPLE. Try another symbol such as MSFT or AAPL, or use the Lookup API.") {
                                // below should be do something when type aaple no symobl
                                alert("no object");
                                document.getElementById("validationInformation").innerHTML = "Select a valid entry";
                            }else{
                                // if we have return we need to create table but status can be success or fail need to kill this problem first
                                //*/
                                if(jsonObject["Status"]=="SUCCESS"){
                                    // $("#stockDetailSection").empty();
                                      $("#nextSlide").prop('disabled', false);
                                      $("#myCarousel").carousel(1);
                                    // we need to create a table use JQUERY
                                    //$("stockDetailTable").append("<table id=\"detailTable\" class=\"table table-striped table-responsive\">")
                                    $("#stockDetailSection").append("<table class=\"table table-striped table-responsive\" id=\"stockDetailTable\"></table>");
                                    $("#stockDetailTable").append("<tr><td><p><strong>Name</strong></p></td><td>" + jsonObject.Name + "</td></tr>");
                                    $("#stockDetailTable").append("<tr><td><p><strong>Symbol</strong></p></td><td>" + jsonObject.Symbol + "</td></tr>");
                                    $("#stockDetailTable").append("<tr><td><p><strong>Last Price</strong></p></td><td>" +"$ " + jsonObject.LastPrice + "</td></tr>");
                                    // handle the change problem 
                                    var change = jsonObject["Change"].toFixed(2);
                                    var changePercent = jsonObject["ChangePercent"].toFixed(2);

                                    $("#stockDetailTable").append("<tr><td><p><strong>Change (Change Percent)</strong></p></td><td id=\"stock_details_changeTextColor\">" + change+" ( "+changePercent +"%"+" ) "+ showArrow(changePercent)+"</td></tr>");
                                    // still need to handle the color of the text
                                    changeTextColor(changePercent, "stock_details_changeTextColor");
                                    
                                    // handle time format problem 
                                    var time = moment(jsonObject["Timestamp"]).format("DD MMM YYYY, HH:mm:ss a");
                                    $("#stockDetailTable").append("<tr><td><p><strong>Time and Date</strong></p></td><td>" + time + "</td></tr>");
                                    
                                    
                                    $("#stockDetailTable").append("<tr><td><p><strong>Market Cap</strong></p></td><td>" + (jsonObject.MarketCap/1000000000).toFixed(2) + "Billion</td></tr>");
                                    $("#stockDetailTable").append("<tr><td><p><strong>Volume</strong></p></td><td>" + jsonObject.Volume + "</td></tr>");
                                     var changeYTD = jsonObject["ChangeYTD"].toFixed(2);
                                 var changePercentYTD =jsonObject["ChangePercentYTD"].toFixed(2);

                                    $("#stockDetailTable").append("<tr><td><p><strong>Change YTD (Change Percent YTD)</strong></p></td><td id =\"stock_details_changeYTDTextColor\">" + changeYTD+" ( "+changePercentYTD +"%"+" ) "+showArrow(changePercentYTD) + "</td></tr>");
                                    
                            changeTextColor(changePercentYTD, "stock_details_changeYTDTextColor");
                                    
                                   $("#stockDetailTable").append("<tr><td><p><strong>Low Price</strong></p></td><td>" + "$ "+jsonObject.High + "</td></tr>");
                                  $("#stockDetailTable").append("<tr><td><p><strong>High Price</strong></p></td><td>" +"$ "+ jsonObject.Low + "</td></tr>");
                                   $("#stockDetailTable").append("<tr><td><p><strong>Opening Price</strong></p></td><td>" +"$ "+ jsonObject.Open + "</td></tr>");
                                    //below handle chart part
                                   //$("stockDetailTable").append("</table>");
                                    var stockImgURL = "http://chart.finance.yahoo.com/t?s=" + jsonObject["Symbol"]+ "&lang=en-US&width=550&height=450";
                                   //$("#stockChart").empty();
                                   $("#stockChart").append("<img id=\"dailyStockChart\" class=\"img-responsive\" src=\"" + stockImgURL + "\" alt=\"daily stock chart\">");
                                    // prepare the curr URL for facebook;
                                  // curr_json_imgURL = "http://chart.finance.yahoo.com/t?s=" + jsonObj["Symbol"]+ "&lang=en-US&width=250&height=250";
                                    
                                    $.ajax({
                                url: "index.php",
                               data: { bingVal : symbol },
                            type: "GET",
                          datatype: "json",
                         success: function(result) {
                             //console.log("this is " + symbol);
                           //alert(result);
                     //alert(result);
                  var jsonObject = jQuery.parseJSON(result);
                     //alert(jsonObject);
                     
                   //newsDisplay(jsonObject);
                    // create the feed data
                     // the count of the news
                     //console.log("feed test" + symbol);
                     
                     var newsCount = jsonObject.d.results.length;
                     for(var i=0; i<newsCount; i++){
                         var singleNews = jsonObject.d.results[i];
                         var newsContent = "<div class=\"well\">";
                         newsContent += "<p class=\"newsTitle\"><a href=\"" + singleNews.Url + "\" target=\"_blank\" >" + singleNews.Title + "</a></p>";
                         newsContent += "<p class=\"newsContent\">" + singleNews.Description + "</p>";
                          //console.log("newsURL"+singleNews.Description);
                          newsContent += "<p class=\"newsPublisher\"><b>" +"Publisher: "+ singleNews.Source + "</b></p>";
                          var date = moment(singleNews.Date).format("DD MMM YYYY HH:mm:ss");
                          newsContent += "<p class=\"newsDate\"><b>" + "Date: "+date + "</b></p>";
                          newsContent += "</div>";
                          //$("#newsFeeds").empty();
                          $("#newsFeeds").append(newsContent);
                        
                     } 
                  }
              });
         $.ajax({
          url: "index.php",
          data: { chartVal: symbol },
          //async: false,
          type: "GET",
          datatype: "json",
          success: function(result) {
              //alert(result); OK
              var jsonObject = jQuery.parseJSON(result);
              render(jsonObject);
          }
        
     });
                                   }else{
                                       document.getElementById("validationInformation").innerHTML = "Select a valid entry";
                $("#nextSlide").prop('disabled', true);
                console.log("this is not valid");
                                       
                                   }
          }                 }
        });
    // below handle the new feed section 
        
    // below is used for create HighStock chart
        //first use interact chart API
     /*
        $.ajax({
          url: "index.php",
          data: { chartVal: symbol },
          //async: false,
          type: "GET",
          datatype: "json",
          success: function(result) {
              //alert(result); OK
              var jsonObject = jQuery.parseJSON(result);
              render(jsonObject);
          }
        
     });*/
     /*
     // PHP call bing  to creat the new feed:
       $.ajax({
                 url: "index.php",
                 data: { bingVal : symbol },
                 type: "GET",
                 datatype: "json",
                 success: function(result) {
                     //alert(result);
                  var jsonObject = jQuery.parseJSON(result);
                   //newsDisplay(jsonObject);
                    // create the feed data
                     // the count of the news
                     
                     var newsCount = jsonObject.d.results.length;
                     for(var i=0; i<newsCount; i++){
                         var singleNews = jsonObject.d.results[i];
                         var newsContent = "<div class=\"well\">";
                         newsContent += "<p class=\"newsTitle\"><a href=\"" + singleNews.Url + "\" target=\"_blank\" >" + singleNews.Title + "</a></p>";
                         newsContent += "<p class=\"newsContent\">" + singleNews.Description + "</p>";
                          newsContent += "<p class=\"newsPublisher\">" +"Publisher: "+ singleNews.Source + "</p>";
                          var date = moment(singleNews.Date).format("DD MMM YYYY HH:mm:ss");
                          newsContent += "<p class=\"newsDate\">" + "Date: "+date + "</p>";
                          newsContent += "</div>";
                          $("#newsFeeds").empty();
                          $("#newsFeeds").append(newsContent);
                        
                     } 
                  }
              });*/

     }
    
</script>
<!-- stock detail call function-->  
<script>
     function showArrow(value) {
                if(value>0) {
                    //arrow image
                    return "<img alt= \"Green_Arrow_Up\" src=\"up.png\">";
                }
                else if(value<0) {
                     //arrow image
                    return "<img alt= \"Red_Arrow_Down\" src=\"down.png\">";
                }
                else return "";
            }
    // change color
    function changeTextColor(value, textID) {
                if(value>0) {
                    $("#"+textID).css('color', 'green');
                }
                else if(value<0) {
                    $("#"+textID).css('color', 'red'); 
                }
                else {};
            }
    
</script>
    
<!--below handle chart part-->
<!-- highstock -->
<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script>
    // _fixData function changee the data in numbers 
            function _fixDate(dateIn) {
                var dat = new Date(dateIn); // create data object
                return Date.UTC(dat.getFullYear(), dat.getMonth(), dat.getDate());
            };
           // create OHLC data , and put in chartSeries. return chartSeries to create chart.
            function _getOHLC(json) {
                var dates = json.Dates || [];
                var elements = json.Elements || [];
                var chartSeries = [];
                if (elements[0]){
                    for (var i = 0, datLen = dates.length; i < datLen; i++) {
                        var dat = _fixDate( dates[i] );
                        var pointData = [
                            dat,
                             elements[0].DataSeries['open'].values[i],
                             elements[0].DataSeries['high'].values[i],
                             elements[0].DataSeries['low'].values[i],
                             elements[0].DataSeries['close'].values[i]
                        ];
                        chartSeries.push( pointData );
                    };
                }
                return chartSeries;
            };
            function render(data) {
                // split the data set into ohlc and volume
                // used in serail ohlc
                var ohlc = _getOHLC(data);
                var symbol = data.Elements[0].Symbol;
                // set the allowed units for data grouping
                var groupingUnits = [[
                    'week',                         // unit name
                    [1]                             // allowed multiples
                ], [
                    'month',
                    [1, 2, 3, 4, 6]
                ]];
                // create the chart
                $('#HistoricalCharts').highcharts('StockChart', {
                    //
                   //set up the chart width
                   
                  chart: {
                   
                   width: 900
                   
                  },
                    
                      navigation:{
                        buttonOptions:{
                            enabled:false
                        }
                    },
                    rangeSelector: {
                        selected: 0,
                        inputEnabled:false,
                        allButtonsEnabled: true,
                        
                        buttons: [{
                            type: 'week',
                            count: 1,
                            text: '1w'
                        }, {
	                        type: 'month',
	                        count: 1,
	                        text: '1m'
                        },{
                            type: 'month',
                            count: 3,
                            text: '3m'
                        }, {
                            type: 'month',
                            count: 6,
                            text: '6m'
                        }, {
                            type: 'ytd',
                            text: 'YTD'
                        }, {
                            type: 'year',
                            count: 1,
                            text: '1y'
                        }, {
                            type: 'all',
                            text: 'All'
                        }]
                    },// use the range selector to defind the botton 
                    title: {
                        text: symbol + ' Stock Value'
                    },
                    yAxis: [{
                        title: {
                            text: 'Stock Value'
                         },
                        height: 200,
                        lineWidth: 2
                    }
                    /*, {
                        top: 200,
                        height: 100,
                        offset: 0,
                        lineWidth: 2
                    }*/
                           ],
                    
                    series: [{
                        type: 'area',
                        name: symbol,
                        data: ohlc,
                        dataGrouping: {
                            units: groupingUnits
                        }, 
                        tooltip:{
                            valueDecimals:2,
                            valuePrefix:"$"
                        },
                    }],
                    credits: {
                        enabled:false
                    }
                 
                });
               // $('#HistoricalCharts').highcharts().reflow();
            };
        </script>
    
<!-- clear function-->
<script>
    function clearResult(){
           /*
            document.location.href = "index.html";*/
        document.getElementById("validationInformation").innerHTML = " ";
        document.myform.inputText.value="";
        
        $("#myCarousel").carousel(0);
        $("#stockDetailSection").empty();
        $("#stockChart").empty();
        //$(".well").remove();
        $("#newsFeeds").empty();
        //$("#newsFeeds").empty();
        $('#HistoricalCharts').empty();
            $("#nextSlide").prop('disabled', true);
            
    }
</script>
    <!--problem-->
     <!-- autocomplete -->
         <script>
            $( "#stockInput" ).autocomplete({
                
                //source: JSON data retrieved from server
                source: function( request, response ) {
                    $.ajax({
                        url: "index.php",
                        data: { input: request.term},
                        type: "GET",
                        datatype: "json",
                        success: function( result ) {
                            var jsonObject = jQuery.parseJSON(result);
                            
                            if(jsonObject.length==0) {
                               document.getElementById("validationInformation").innerHTML = "Select a valid entry";
                                $("#nextSlide").prop('disabled', true);
                               // $("#validationInformation").innerHTML = "Select a valid entry";
                                response(null);

                            }
                            else {
                                document.getElementById("validationInformation").innerHTML = "";

                                var data = new Array();

                                for(var i=0; i<jsonObject.length; i++) {
                                    data[i] = { label: jsonObject[i].Symbol + " - " + jsonObject[i].Name + " ( " + jsonObject[i].Exchange + " ) ", value: jsonObject[i].Symbol};
                                }
                                response( data );

                            }                                
                        }
                    });
                }
            });
        </script>
    </body>
</html>
